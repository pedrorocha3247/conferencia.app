<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validador de Remessas</title>
    
    <link href="https://bootswatch.com/5/cyborg/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #222; }
        .container { max-width: 700px; margin-top: 50px; margin-bottom: 50px; }
        .company-logo { display: block; margin: 0 auto 30px auto; max-height: 80px; width: auto; }
        .tab-content { border: 1px solid #4e5d6c; border-top: none; padding: 2rem; border-radius: 0 0 .375rem .375rem; background-color: #2a3137; }
        .nav-pills .nav-link.active { background-color: var(--bs-primary); color: #fff; }
        .company-selector { position: absolute; top: 1rem; right: 1rem; z-index: 1050; }
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #222; display: flex; justify-content: center; align-items: center; z-index: 9999; opacity: 1; transition: opacity 0.8s ease-out; }
        #splash-screen .company-logo { max-width: 350px; width: 80%; animation: pulse 2s infinite ease-in-out; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }

        body.theme-pickmoney { --bs-primary: #28a745; }
        body.theme-pickmoney .btn-primary {
            --bs-btn-bg: var(--bs-primary);
            --bs-btn-border-color: var(--bs-primary);
            --bs-btn-hover-bg: #228c3a;
            --bs-btn-hover-border-color: #208236;
        }
        body.theme-pickmoney .btn-secondary {
             --bs-btn-bg: #5a6268;
             --bs-btn-border-color: #5a6268;
        }
    </style>
</head>
<body>
    <div id="splash-screen">
        <img src="" alt="Logótipo da Empresa" class="company-logo">
    </div>

    <div class="company-selector">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">Empresas</button>
            <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item company-choice" href="#" data-company="momentum">Momentum</a></li>
                <li><a class="dropdown-item company-choice" href="#" data-company="pickmoney">Pick Money</a></li>
            </ul>
        </div>
    </div>

    <div class="container" id="main-content" style="display: none;">
        <div><img src="" alt="Logótipo da Empresa" class="company-logo"></div>
        
        <ul class="nav nav-pills nav-fill" id="myTab" role="tablist">
            <li class="nav-item" role="presentation" id="validacao-tab-li">
                <button class="nav-link active" id="validacao-tab" data-bs-toggle="tab" data-bs-target="#validacao-tab-pane" type="button" role="tab">Validação</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="comparativo-tab" data-bs-toggle="tab" data-bs-target="#comparativo-tab-pane" type="button" role="tab">Comparação</button>
            </li>
            <!-- <<NOVA ABA>> -->
            <li class="nav-item" role="presentation" id="repasse-tab-li">
                <button class="nav-link" id="repasse-tab" data-bs-toggle="tab" data-bs-target="#repasse-tab-pane" type="button" role="tab">Repasse</button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="validacao-tab-pane" role="tabpanel">
                <h4 class="mb-3 text-center">Validador de Remessas</h4>
                <p class="text-muted text-center mb-4">Selecione o modo e envie um único arquivo PDF.</p>
                <form id="upload-form" action="/upload" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Modo de Análise:</label>
                        <div class="form-check mb-2"><input class="form-check-input" type="radio" name="modo_separacao" value="boleto" checked><label class="form-check-label">Boleto</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="modo_separacao" value="debito_credito"><label class="form-check-label">Débito/Crédito</label></div>
                    </div>
                    <div class="mb-3 mt-3"><label class="form-label fw-bold">Envie o Arquivo PDF:</label><input type="file" class="form-control" name="pdf_file" accept=".pdf" required></div>
                    <div class="d-grid mt-3"><button id="submit-button" type="submit" class="btn btn-primary btn-lg"><span class="button-text">Validar Arquivo</span></button></div>
                </form>
            </div>
            
            <div class="tab-pane fade" id="comparativo-tab-pane" role="tabpanel">
                <h4 class="mb-3 text-center">Comparativo Entre Meses</h4>
                <p class="text-muted text-center mb-4">Envie os arquivos do mês anterior e atual.</p>
                <form id="compare-form" action="/compare" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Modo de Análise:</label>
                        <div class="form-check mb-2"><input class="form-check-input" type="radio" name="modo_separacao_comp" value="boleto" checked><label class="form-check-label">Boleto</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="modo_separacao_comp" value="debito_credito"><label class="form-check-label">Débito/Crédito</label></div>
                    </div>
                    <div class="mb-3 mt-3"><label class="form-label fw-bold">Arquivo do Mês Anterior:</label><input type="file" class="form-control" name="pdf_mes_anterior" accept=".pdf" required></div>
                    <div class="mb-3 mt-3"><label class="form-label fw-bold">Arquivo do Mês Atual:</label><input type="file" class="form-control" name="pdf_mes_atual" accept=".pdf" required></div>
                    <div class="d-grid mt-3 mb-2"><button id="compare-button" type="submit" class="btn btn-primary btn-lg"><span class="button-text">Comparar Arquivos</span></button></div>
                </form>
            </div>

            <!-- <<NOVO PAINEL DE ABA>> -->
            <div class="tab-pane fade" id="repasse-tab-pane" role="tabpanel">
                <h4 class="mb-3 text-center">Conciliação de Repasse</h4>
                <p class="text-muted text-center mb-4">Envie as planilhas do Diário e do Sistema para conciliação.</p>
                <form id="repasse-form" action="/repasse" method="post" enctype="multipart/form-data">
                    <div class="mb-3 mt-3">
                        <label for="diario_file" class="form-label fw-bold">1. Envie a planilha "Diário":</label>
                        <input type="file" class="form-control" name="diario_file" id="diario_file" accept=".xlsx" required>
                    </div>
                    <div class="mb-3 mt-3">
                        <label for="sistema_file" class="form-label fw-bold">2. Envie a planilha "Sistema":</label>
                        <input type="file" class="form-control" name="sistema_file" id="sistema_file" accept=".xlsx" required>
                    </div>
                    <div class="d-grid mt-4 mb-2">
                        <button id="repasse-button" type="submit" class="btn btn-primary btn-lg"><span class="button-text">Conciliar Repasse</span></button>
                    </div>
                </form>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const logos = {
                momentum: "https://i.postimg.cc/k52qrH0Z/Imagem1.png",
                pickmoney: "https://i.postimg.cc/k52qrH0Z/Imagem1.png" // Substitua pelo logo correto
            };

            const body = document.body;
            const logoElements = document.querySelectorAll('.company-logo');
            const validacaoTabLi = document.getElementById('validacao-tab-li');
            const repasseTabLi = document.getElementById('repasse-tab-li'); // Nova aba
            const validacaoTabButton = document.getElementById('validacao-tab');
            const comparativoTabButton = document.getElementById('comparativo-tab');
            const validacaoPane = document.getElementById('validacao-tab-pane');
            const comparativoPane = document.getElementById('comparativo-tab-pane');
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');

            function applyCompanyTheme(company) {
                localStorage.setItem('selectedCompany', company);
                logoElements.forEach(logo => { logo.src = logos[company]; });

                // Remove o 'active' de todas as abas e painéis
                document.querySelectorAll('#myTab .nav-link').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('#myTabContent .tab-pane').forEach(pane => pane.classList.remove('show', 'active'));

                if (company === 'pickmoney') {
                    body.classList.add('theme-pickmoney');
                    validacaoTabLi.style.display = 'none';
                    repasseTabLi.style.display = 'none'; // Esconde Repasse
                    
                    // Ativa a aba Comparação
                    comparativoTabButton.classList.add('active');
                    comparativoPane.classList.add('show', 'active');
                } else { // Padrão é Momentum
                    body.classList.remove('theme-pickmoney');
                    validacaoTabLi.style.display = 'block';
                    repasseTabLi.style.display = 'block'; // Mostra Repasse

                    // Ativa a aba Validação (padrão)
                    validacaoTabButton.classList.add('active');
                    validacaoPane.classList.add('show', 'active');
                }
            }

            document.querySelectorAll('.company-choice').forEach(choice => {
                choice.addEventListener('click', function(e) {
                    e.preventDefault();
                    applyCompanyTheme(this.getAttribute('data-company'));
                });
            });

            const savedCompany = localStorage.getItem('selectedCompany') || 'momentum';
            applyCompanyTheme(savedCompany);

            setTimeout(() => {
                if(splashScreen) {
                    splashScreen.style.opacity = '0';
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                        mainContent.style.display = 'block';
                    }, 600);
                }
            }, 2000);
            
            // Adiciona spinner para os botões de submit
            function setupFormSubmitSpinner(formId, buttonId) {
                const form = document.getElementById(formId);
                const button = document.getElementById(buttonId);
                if(form && button){
                    form.addEventListener('submit', function() {
                        button.disabled = true;
                        const buttonText = button.querySelector('.button-text');
                        if (buttonText) buttonText.textContent = ' Processando...';
                    });
                }
            }
            setupFormSubmitSpinner('upload-form', 'submit-button');
            setupFormSubmitSpinner('compare-form', 'compare-button');
            setupFormSubmitSpinner('repasse-form', 'repasse-button'); // Adiciona spinner ao novo botão
        });
    </script>
</body>
</html>
