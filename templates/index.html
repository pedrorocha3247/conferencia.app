<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
    <style>
        /* ... styles ... */
        .progress-bar-container {
            width: 100%;
            background-color: #37404a;
            border-radius: .375rem;
            display: none; /* Inicia escondido */
        }
        .progress-bar-fill {
            width: 0%;
            height: 20px;
            background-color: #2b90d9;
            border-radius: .375rem;
            transition: width 0.5s ease-in-out;
            text-align: center;
            color: white;
            font-weight: bold;
            line-height: 20px;
        }
    </style>
</head>
<body>
    <div class="container" id="main-content" style="display: none;">
        <div id="alert-placeholder"></div>

        <ul class="nav nav-pills nav-fill" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#validacao-tab-pane">Validação</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#comparativo-tab-pane">Comparação</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#lote-tab-pane">Lote</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="validacao-tab-pane" role="tabpanel">
                <div class="d-grid mt-3">
                    <button id="submit-button" type="submit" class="btn btn-primary btn-lg">Validar Arquivo</button>
                </div>
            </div>
            <div class="tab-pane fade" id="comparativo-tab-pane" role="tabpanel">
                 <div class="d-grid mt-3 mb-2">
                    <button id="compare-button" type="submit" class="btn btn-primary btn-lg">Comparar Arquivos</button>
                </div>
            </div>
            <div class="tab-pane fade" id="lote-tab-pane" role="tabpanel">
                <h4 class="mb-3 text-center">Processamento em Lote</h4>
                <p class="text-muted text-center mb-4">Envie um arquivo .ZIP com múltiplos PDFs para validação consolidada.</p>
                <form id="batch-form" action="/batch_upload" method="post" enctype="multipart/form-data">
                    <div class="mb-3 mt-3">
                        <label for="zip_file" class="form-label fw-bold">Envie o Arquivo .ZIP:</label>
                        <input type="file" class="form-control" name="zip_file" id="zip_file" accept=".zip" required>
                    </div>
                    <div class="d-grid mt-3">
                        <button id="batch-button" type="submit" class="btn btn-primary btn-lg">Processar Lote</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="progress-bar-container mt-4">
            <div id="progress-bar" class="progress-bar-fill"></div>
        </div>
        <p id="progress-message" class="text-center text-muted mt-2"></p>
    </div>

    <script>
        // ... função setupFormSubmitSpinner agora controla o progresso ...
        function setupFormSubmitSpinner(formId, buttonId) {
            document.getElementById(formId).addEventListener('submit', function() {
                const button = document.getElementById(buttonId);
                const progressBarContainer = document.querySelector('.progress-bar-container');
                const progressBar = document.getElementById('progress-bar');
                const progressMessage = document.getElementById('progress-message');
                
                button.disabled = true;
                progressBarContainer.style.display = 'block';

                const messages = ["Analisando arquivos...", "Extraindo texto...", "Cruzando informações...", "Quase pronto..."];
                let msgIndex = 0;
                let progress = 0;

                progressMessage.textContent = messages[0];
                progressBar.style.width = '10%';

                const interval = setInterval(() => {
                    msgIndex = (msgIndex + 1) % messages.length;
                    progress = Math.min(progress + 25, 90); // Simula o progresso sem chegar a 100%
                    progressMessage.textContent = messages[msgIndex];
                    progressBar.style.width = progress + '%';
                }, 2500); // Muda a mensagem a cada 2.5s
            });
        }
        setupFormSubmitSpinner('upload-form', 'submit-button');
        setupFormSubmitSpinner('compare-form', 'compare-button');
        setupFormSubmitSpinner('batch-form', 'batch-button');

        // NOVO: Script para exibir alertas de erro
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const error = params.get('error');
            if (error) {
                const alertPlaceholder = document.getElementById('alert-placeholder');
                alertPlaceholder.innerHTML = `
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Erro:</strong> ${error}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>`;
            }
        });
    </script>
</body>
</html>
